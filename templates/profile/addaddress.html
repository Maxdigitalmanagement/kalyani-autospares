{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="author" content="Hari Babu" />
    <meta name="description" content="Kalyani Autospares add address Page" />
    <meta name="keywords" content="Food, Restaurant">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- SITE TITLE -->
    <title>Kalyani Autospares | Add Addresses</title>
    <!-- CSS -->
    <link href="{% static 'css/mainstyle.css' %}" rel="stylesheet">
    <link href="{% static 'css/profilestyle.css' %}" rel="stylesheet">
    <!-- FAVICON AND TOUCH ICONS -->
    <link rel="shortcut icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
    <link rel="icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'images/apple-touch-icon-152x152.png' %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'images/apple-touch-icon-120x120.png' %}">
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'images/apple-touch-icon-76x76.png' %}">
    <link rel="apple-touch-icon" href="{% static 'images/apple-touch-icon.png' %}">
    <link rel="icon" href="{% static 'images/apple-touch-icon.png' %}" type="image/x-icon">

    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <script src="https://kit.fontawesome.com/d6bb2a24d1.js" crossorigin="anonymous"></script>

    <style>
        * {
            cursor: url("{% static '/images/cursor.svg' %}"),
            auto !important;
        }
    </style>

    <!-- slider -->

    <link rel="stylesheet" type="text/css" href="{% static '/css/slick.css'%}" />

</head>

<body>

    {% include 'includes/preloader.html' %}

    <header>
        <nav id="navbar">
            <div id="nav_tot" class="topnav">
                <div class="left">
                    <img class="imagelogo" onclick="gohome()" src="{% static 'images/logo.png'%}" alt="">
                    <img class="imagelogo_name" onclick="gohome()" src="{% static 'images/logo_name.svg'%}" alt="">
                </div>
                <div class="right">
                    <div onclick="gocart()" class="cart_ic">
                        <p class="cartitems">{{cart_items_no}}</p>
                        <img src="{% static '/images/cart_ic.svg'%}" alt="">
                    </div>
                    <div class="tab_nav">
                        <div class="home pill">
                            <img onclick="gohome()" src="{% static '/images/home_ic.svg'%}" alt="">
                            <h4>HOME</h4>
                        </div>
                        <div onclick="goprofile()" class="profile pill pillactive">
                            <img src="{% static '/images/profile_ic.svg'%}" alt="">
                            <h4>PROFILE</h4>
                        </div>
                        <div class="favorites pill">
                            <img onclick="gofav()" src="{% static '/images/fav_ic.svg'%}" alt="">
                            <h4>FAVORITE'S</h4>
                        </div>
                    </div>
                </div>
            </div>
            <div class="statusbar">
                <div id="sbleft" class="left">
                    <img id="prof_back" onclick="goprofile()" src="{% static '/images/backbtn.svg'%}" alt="">
                </div>
                <div class="middle">
                    <h3>Add Address</h3>
                </div>
                <div class="right">
                    <div onclick="gocart()" class="cart_ic">
						<p class="cartitems">{{cart_items_no}}</p>
						<img src="{% static '/images/cart_ic_black.svg'%}" alt="">
					</div>
                </div>
            </div>



        </nav>

    </header>

    <main>
        <section class="section1">
            <div class="wrapper ordwrpper myinf">

                <h1 class="title">Add Address</h1>

                <form action="{% if edit_address %}{% url 'edit_address' address.id %}{% else %}{% url 'add_address' %}{% endif %}" method="POST">
                    {% csrf_token %}
                    <div class="main_or_wr disfle">

                        <div id="first_namewrp" class=" wrpp">
                            <h4>First Name {{edit_address}}</h4>
                            <input name="first_name" id="first_name-input" type="text" required {% if edit_address %} value="{{address.first_name}}" {% endif %}
                                placeholder="enter first name">
                        </div>
                        <div id="last_namewrp" class=" wrpp">
                            <h4>last Name</h4>
                            <input name="last_name" id="last_name-input" type="text" required {% if edit_address %} value="{{address.last_name}}" {% endif %}
                                placeholder="enter last name">
                        </div>
                        <div id="last_namewrp" class=" wrpp">
                            <h4>last Name</h4>
                            <input name="email" id="email-input" type="email" required placeholder="enter email" {% if edit_address %} value="{{address.email}}" {% endif %}>
                        </div>
                        <div id="phonewrp" class="wrpp wrph">
                            <h4>Phone number</h4>
                            <div class="phone_wr">
                                <h3 id="country_code">+91</h3>
                                <!-- <input type="number" name="ccode" id="country_code" value="91" maxlength="2"> -->
                                <input name="phone" id="phone-input" type="tel" required
                                    placeholder="enter phone number" maxlength="10" {% if edit_address %} value="{{address.phone}}" {% endif %}>
                            </div>
                        </div>
                        <div id="pinwrp" class=" wrpp">
                            <h4>Pincode</h4>
                            <input name="pincode" id="pincode-input" type="text" required placeholder="enter Pincode" {% if edit_address %} value="{{address.pincode}}" {% endif %}>
                            <small id="error-pin" style=" display: none; color: red;">Enter correct pincode</small>
                        </div>
                        <div id="hnowrp" class=" wrpp">
                            <h4>Address line 1</h4>
                            <input name="address_line_1" id="addrress_line_1-input" required type="text" {% if edit_address %} value="{{address.address_line_1}}" {% endif %}
                                placeholder="House no, street name / Building name">
                        </div>
                        <div id="rnamwrp" class=" wrpp">
                            <h4>address line 2</h4>
                            <input name="address_line_2" id="" type="text" required placeholder="village / Area / Colony" {% if edit_address %} value="{{address.address_line_2}}" {% endif %}>
                        </div>
                        <div id="citywrp" class=" wrpp">
                            <h4>City</h4>
                            <input name="city" id="city-input" type="text" readonly required {% if edit_address %} value="{{address.city}}" {% endif %}
                                placeholder="Fetch pincode">
                        </div>
                        <div id="statewrp" class=" wrpp">
                            <h4>State</h4>
                            <input name="state" id="state-input" type="text" readonly required {% if edit_address %} value="{{address.state}}" {% endif %}
                                placeholder="Fetch pincode">
                        </div>
                        <input type="hidden" id="country-input" name="country" {% if edit_address %} value="{{address.country}}" {% endif %}>
                    </div>
                    <button id="save_address_btn" type="submit" style="display: none;"></button>

                </form>


                <div class="btn_save_info">SAVE ADDRESS</div>
            </div>

        </section>



    </main>







    <script>
        var address_get = false
        const save_btn = document.querySelector('.btn_save_info');
        const pincode = document.getElementById('pincode-input');
        const city_in = document.getElementById('city-input');
        const state_in = document.getElementById('state-input');
        const country_in = document.getElementById('country-input');

        window.addEventListener('load', () => {
            save_btn.innerHTML = "VERIFY PIN";
        });

        save_btn.addEventListener('click', () => {
            if (!address_get) {
                var pin = pincode.value;
                save_btn.innerHTML = "fetching...";
                fetchpincode(pin);
            }
            else {
                document.getElementById('save_address_btn').click();
            }
        });

        function fetchpincode(pinc) {
            url = "https://api.postalpincode.in/pincode/" + pinc;
            fetch(url).then(response => response.json()).then(data => {
                console.log(data);
                if (data[0].Status == "Success") {
                    var city = data[0].PostOffice[0].Block;
                    var state = data[0].PostOffice[0].State;
                    var country = data[0].PostOffice[0].Country;
                    console.log(data[0].Message);
                    city_in.value = city;
                    state_in.value = state;
                    country_in.value = country;
                    pincode.setAttribute('readonly', true);
                    save_btn.innerHTML = "SAVE ADDRESS";
                    address_get = true;
                }
                if (data[0].Status == "Error") {
                    document.getElementById('error-pin').style.display="block";
                    setTimeout(function () {
                        $('#error-pin').fadeOut('slow')
                    }, 3000)
                    save_btn.innerHTML = "VERIFY PIN";
                }

            });
        }


    </script>



    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="{% static 'js/main.js'%}"></script>
    <script src="{% static 'js/slick.js'%}"></script>
    <script src="{% static 'js/profile.js'%}"></script>

    {% include 'includes/links.html' %}


</body>


</html>